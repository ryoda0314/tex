# TeX数式学習サイト（Duolingo風）MVP計画書（確定版）

作成日: 2026-01-01（Asia/Tokyo）

---

## 1. テーマ

**完全初心者向けに、LaTeX（TeX）の「数式の打ち方」だけを、Duolingoのようなゲーミフィケーションで習得させる学習サイト**を作る。  
MVPは「数式のみ」を扱い、文章中のTeXや高度な環境（align等）は対象外。

---

## 2. MVPの目的（成果指標）

### 2.1 目的
- 学習者が「見た数式をTeXで書ける」状態に到達する（最小の成功体験を確実に作る）。
- 1回の学習が短く終わり、**Streak**で継続できる。

### 2.2 成果（MVPの到達ライン）
- Unit 1〜3（上付き/下付き・分数・平方根）を一通り学習できる。
- レッスンは **8問/回**、短時間（**15〜30秒/問**目安）で回せる。
- 進捗が保存され、XPとStreakが更新される。
- 正答率80%で次のレッスンが解禁される。

---

## 3. 対象範囲（スコープ）

### 3.1 対象（MVP）
- **数式モードの基本表現のみ**
  - 上付き・下付き（`^`, `_`）
  - 分数（`\frac`）
  - 平方根（`\sqrt`）

### 3.2 対象外（将来拡張）
- 行列、場合分け、整列、積分・総和、極限、記号セットの拡張、文章中のTeX、パッケージ依存など。

---

## 4. 仕様（プロダクト仕様）

### 4.1 表示・入力モード
- 表示は **ディスプレイ固定**（内部では `\[ ... \]` 相当でレンダ）。
- ユーザーは **数式本体のみ**を扱う（ラッパーはUI側で吸収）。

### 4.2 レンダリング
- エンジンは「どちらでも可」を前提に、MVP推奨は **KaTeX**（高速・体験が軽い）。

### 4.3 採点（段階別）
- **Step1〜3（選択/マッチ）**：選択肢の一致で採点。
- **Step4（穴埋め）**：空欄ごとの一致で採点（部分点の余地あり）。
- **Step5（並び替え：タイル）**：タイル列→AST化→正解AST一致（高速・安定）。
- **Step6（入力）**：`acceptable[]`（許容表現）で一致（MVP現実解）。

> 重要: MVPでは「厳密な数式同値判定（CAS/パーサ）」は行わず、  
> 学習が前に進むことを優先して **許容表現運用**とする。

---

## 5. タイル設計（粒度とルール）

### 5.1 タイル粒度（確定）
ユーザー希望に基づき、タイルは以下の単位とする。

- コマンド：例 `\frac`, `\sqrt`（**1タイル**）
- 演算子：`^`, `_`（**1タイル**）
- グループ：`{a}`, `{n+1}`, `{x^2}`（**中身ごと1タイル**）
- アトム：`x`, `a`, `+`, `1`, `2`, `(`, `)`（基本は1文字/1トークン）

例（分数）: `\frac` / `{a}` / `{b}`  
例（上付き）: `x` / `^` / `{2}`  
例（下付き）: `a` / `_` / `{n+1}`

### 5.2 制約（配置）
- **ハード制約なし（自由配置）**を基本（5A）。
- ただし初心者向けに「ソフト誘導」を実装する（例：`^` の後は `{...}` を推奨表示）。

---

## 6. ゲーミフィケーション仕様（MVP最小）

- **XP**：正解で付与（例：+10/問）。
- **Streak**：1日1レッスンで更新。
- **解禁ルール**：各レッスン **正答率80%（7/8）** で次レッスン解禁。
- （任意）連続正解ボーナス：3連続/5連続など（MVPでは後回し可）。

---

## 7. 問題タイプ（Duolingo寄せの学習曲線）

ユーザー指定の順序を「段階アンロック」として採用する。

### Step1: 数式 → コード選択
- 数式カードを見せ、正しいTeXコードを選ぶ。

### Step2: コード → 数式選択
- TeXコードを見せ、正しいレンダ結果（数式カード）を選ぶ。

### Step3: マッチ（複数数式×複数コード）
- 左に数式、右にコードを並べ、対応する組を選ぶ（DuolingoのMatch）。

### Step4: 穴埋め（Cloze）
- `x □ {2}` のようなフレームに、`^` や `{...}` を埋める。

### Step5: 並び替え（Arrange）
- タイルを並べて正しい式を組み立てる（タイル粒度は5章のとおり）。

### Step6: 入力（最終）
- 見た数式（または日本語指示）からTeXを入力する。

---

## 8. 学習ツリー（MVPのユニット）

- **Unit 1**：上付き・下付き（`^`, `_`, `{...}`）
- **Unit 2**：分数（`\frac` + `{...}`×2）
- **Unit 3**：平方根（`\sqrt` + `{...}`）

---

## 9. Unit 1 問題計画（Lesson 1〜4）

### Unit 1 ゴール
- `x^{2}` / `a_{n}` / `a_{n+1}` を迷わず作れる。
- 複数文字（`n+1` 等）は `{...}` で囲むのが基本、を定着させる。
- `^`（上）と `_`（下）を混同しない。

---

### Lesson 1：対応付けを作る（Recognition）
**狙い**：見た目 ↔ コードの対応を作る。書く負荷は最小。

**8問構成（例）**
1. Step1 数式→コード選択（上付き）
2. Step1 数式→コード選択（下付き）
3. Step2 コード→数式選択（上付き）
4. Step2 コード→数式選択（下付き）
5. Step3 マッチ（3ペア：`x^2`, `a_n`, `a_{n+1}`）
6. Step3 マッチ（3ペア：`x^3`, `a_i`, `a_{k+1}`）
7. Step4 穴埋め（1穴：`x □ {2}` に `^`）
8. Step4 穴埋め（1穴：`a □ {n}` に `_`）

---

### Lesson 2：構造を組み立てる（Structure）
**狙い**：穴埋めと並び替えで「型」を身体化する。

**8問構成（例）**
1. Step2 コード→数式選択（復習）
2. Step3 マッチ（混合）
3. Step4 穴埋め（2穴：`a _ □` / `x ^ □`）
4. Step4 穴埋め（base穴：`□ ^ {2}` / `□ _ {n}`）
5. Step5 並び替え：`x` / `^` / `{2}`
6. Step5 並び替え：`a` / `_` / `{n}`
7. Step5 並び替え：`a` / `_` / `{n+1}`
8. Step5 並び替え（誤誘導あり）：`x` / `_` / `{n}` vs `x` / `^` / `{n}`

---

### Lesson 3：混合ドリル（Synthesis）
**狙い**：Unit内混合で定着。最後に軽い入力チェックを1問。

**8問構成（例）**
1. Step3 マッチ（4ペア：上/下混合）
2. Step4 穴埋め（2穴：複合の導入）
3. Step5 並び替え（複合）：`a` / `_` / `{n}` / `^` / `{2}`
4. Step5 並び替え：`x` / `^` / `{n+1}`
5. Step5 並び替え（誤誘導：`^` と `_` 両方を混ぜる）
6. Step4 穴埋め（典型ミス是正：`x ^ n+1` を正しく）
7. Step2 コード→数式選択（軽い確認）
8. Step6 入力（最終1問）：例「\(a_{n+1}\) を入力」

---

### Lesson 4：応用（Input-Heavy Checkpoint）
**狙い**：タイル依存を抜けて「自力入力」を主役にする。  
**方針**：成功体験のウォームアップ後、入力を連続させる。

**8問構成（確定案）**
1. Step4 穴埋め（2穴）：`a □ {n+1} □ {2}`（`_` と `^`）
2. Step5 並び替え（複合）：`a` / `_` / `{n+1}` / `^` / `{2}`
3. Step6 入力（見た目→TeX）：\(x^2\)
4. Step6 入力（見た目→TeX）：\(a_n\)
5. Step6 入力（見た目→TeX）：\(a_{n+1}\)
6. Step6 入力（見た目→TeX）：\(x_{i}^{2}\)
7. Step6 入力（日本語→TeX）：「a の添字を n+1、上付きを 2」
8. Step6 入力（ミニ応用）：\(x_{n+1}^{k+1}\)

---

## 10. 入力（Step6）の採点運用（MVP現実解）

### 10.1 正規化（最低限）
- 空白は無視（`a_{ n+1 }` などを許容）
- `x^2` と `x^{2}` は **許容**（ただし学習誘導は `{}` 版）
- `a_{n}^{2}` と `a^{2}_{n}` は見た目同じなので **許容**（複合問題のみ）

### 10.2 不許可（意味が変わる）
- `a_n+1`（添字ではなく加算になる）
- `x_i^2+1` 等、余計な項が入るもの

### 10.3 フィードバック（9B）
- 1回目：短い指摘（例：「`n+1` は `{n+1}`」）
- 2回目：型の提示（例：「形：`a_{...}^{...}`」）
- 3回目：正解表示＋1行理由

---

## 11. 次の成果物（実装に落とすための出力）
この計画から、次のデータをそのまま作成できる。

- Unit 1（Lesson 1〜4、計32問）の **問題JSON**（type別スキーマ）
- Unit 2（分数）/ Unit 3（平方根）の同形式展開
- タイル→AST仕様（SUP/SUB/FRAC/SQRT）と比較器
- 初心者向けヒント辞書（典型ミス → 1行ヒント）

---
